var m=(s,e,a)=>new Promise((y,o)=>{var d=l=>{try{p(a.next(l))}catch(c){o(c)}},g=l=>{try{p(a.throw(l))}catch(c){o(c)}},p=l=>l.done?y(l.value):Promise.resolve(l.value).then(d,g);p((a=a.apply(s,e)).next())});import{k as h,_ as D,c as n,a as t,t as u,e as w,r as f,d as _,l as v,w as b,v as q,F as k,f as C,m as S,n as O,b as P,o as i}from"./index-Bp8818RF.js";/**
 * @license lucide-vue-next v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=h("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-vue-next v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=h("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-vue-next v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=h("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-vue-next v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=h("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),M={name:"POCreationModal",components:{X:F,ChevronDown:T,ShoppingCart:V},props:{request:{type:Object,required:!0}},emits:["close","created"],data(){return{isSubmitting:!1,showValidation:!1,suppliers:[],formData:{supplier:"",required_date:this.getDefaultRequiredDate(),notes:""}}},computed:{today(){return new Date().toISOString().split("T")[0]},isFormValid(){return this.formData.supplier&&this.formData.required_date}},mounted(){return m(this,null,function*(){yield this.loadSuppliers()})},methods:{getDefaultRequiredDate(){const s=new Date;return s.setDate(s.getDate()+14),s.toISOString().split("T")[0]},loadSuppliers(){return m(this,null,function*(){try{const s=yield fetch("/api/method/material_requisition.api.purchase_order.get_suppliers",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const e=yield s.json();if(e.exc)throw new Error(e.exc);this.suppliers=e.message||[]}catch(s){console.error("Failed to load suppliers:",s),this.suppliers=[]}})},createPO(){return m(this,null,function*(){var s;if(!this.isFormValid){this.showValidation=!0;return}this.isSubmitting=!0;try{const e=yield fetch("/api/method/material_requisition.api.purchase_order.create_from_material_request",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""},body:JSON.stringify({material_request:this.request.name,supplier:this.formData.supplier,required_date:this.formData.required_date,notes:this.formData.notes})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=yield e.json();if(a.exc)throw new Error(a.exc);this.showSuccessMessage((s=a.message)==null?void 0:s.name),this.$emit("created",a.message)}catch(e){console.error("Failed to create PO:",e),this.showErrorMessage(e.message)}finally{this.isSubmitting=!1}})},showSuccessMessage(s){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent=`✅ Purchase Order ${s} created successfully!`,document.body.appendChild(e),setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e)},3e3)},showErrorMessage(s){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent=`❌ Error: ${s}`,document.body.appendChild(e),setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e)},5e3)}}},j={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},E={class:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},N={class:"flex items-center justify-between p-6 border-b"},z={class:"text-gray-600"},B={class:"p-6"},R={class:"mb-6"},X={class:"relative"},H=["value"],I={key:0,class:"text-red-500 text-sm mt-1"},A={class:"mb-6"},L=["min"],U={key:0,class:"text-red-500 text-sm mt-1"},J={class:"mb-6"},G={class:"bg-gray-50 rounded-lg p-4 max-h-48 overflow-y-auto"},K={class:"font-medium text-gray-800"},Q={class:"text-sm text-gray-600"},W={class:"text-right"},Y={class:"font-semibold text-gray-800"},Z={class:"mb-6"},$={class:"flex justify-end space-x-4"},ee=["disabled"],te={key:0},se={key:1},re={key:3,class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"};function oe(s,e,a,y,o,d){var c,x;const g=f("X"),p=f("ChevronDown"),l=f("ShoppingCart");return i(),n("div",j,[t("div",E,[t("div",N,[t("div",null,[e[6]||(e[6]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Create Purchase Order",-1)),t("p",z,u((c=a.request)==null?void 0:c.name),1)]),t("button",{onClick:e[0]||(e[0]=r=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[w(g,{class:"w-6 h-6"})])]),t("div",B,[t("div",R,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" Supplier "),t("span",{class:"text-red-500"},"*")],-1)),t("div",X,[b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.formData.supplier=r),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",required:""},[e[7]||(e[7]=t("option",{value:""},"Select a supplier...",-1)),(i(!0),n(k,null,C(o.suppliers,r=>(i(),n("option",{key:r.name,value:r.name},u(r.supplier_name),9,H))),128))],512),[[q,o.formData.supplier]]),w(p,{class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5 pointer-events-none"})]),!o.formData.supplier&&o.showValidation?(i(),n("p",I," Please select a supplier ")):_("",!0)]),t("div",A,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" Required By "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.formData.required_date=r),type:"date",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:d.today,required:""},null,8,L),[[S,o.formData.required_date]]),!o.formData.required_date&&o.showValidation?(i(),n("p",U," Please select a required date ")):_("",!0)]),t("div",J,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-3"},"Items to Order",-1)),t("div",G,[(i(!0),n(k,null,C(((x=a.request)==null?void 0:x.items)||[],r=>(i(),n("div",{key:r.item_code,class:"flex items-center justify-between py-2 border-b border-gray-200 last:border-b-0"},[t("div",null,[t("p",K,u(r.item_name),1),t("p",Q,u(r.item_code),1)]),t("div",W,[t("p",Y,u(r.qty)+" "+u(r.uom),1)])]))),128))])]),t("div",Z,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Notes (Optional) ",-1)),b(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.formData.notes=r),rows:"3",placeholder:"Add any special instructions for the supplier...",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[S,o.formData.notes]])]),t("div",$,[t("button",{onClick:e[4]||(e[4]=r=>s.$emit("close")),class:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),t("button",{onClick:e[5]||(e[5]=(...r)=>d.createPO&&d.createPO(...r)),disabled:o.isSubmitting||!d.isFormValid,class:O(["px-8 py-3 rounded-lg font-semibold flex items-center space-x-2 transition-all",o.isSubmitting||!d.isFormValid?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white transform hover:scale-105 shadow-lg"])},[o.isSubmitting?(i(),n("span",te,"Creating PO...")):(i(),n("span",se,"Create Purchase Order")),o.isSubmitting?(i(),n("div",re)):(i(),P(l,{key:2,class:"w-5 h-5"}))],10,ee)])])])])}const le=D(M,[["render",oe]]);export{ne as A,le as P,V as S};
