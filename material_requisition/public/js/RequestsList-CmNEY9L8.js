var B=Object.defineProperty,L=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var P=(t,e,r)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_=(t,e)=>{for(var r in e||(e={}))F.call(e,r)&&P(t,r,e[r]);if(q)for(var r of q(e))T.call(e,r)&&P(t,r,e[r]);return t},v=(t,e)=>L(t,N(e));var S=(t,e,r)=>new Promise((k,d)=>{var l=c=>{try{g(r.next(c))}catch(p){d(p)}},y=c=>{try{g(r.throw(c))}catch(p){d(p)}},g=c=>c.done?k(c.value):Promise.resolve(c.value).then(l,y);g((r=r.apply(t,e)).next())});import{P as j}from"./POCreationModal-BLAL7tLJ.js";import{_ as D,C as A,P as E,A as V,c as n,a as s,b as O,d as h,e as w,r as x,F as m,f as b,t as i,g as M,h as z,T as H,i as I,o,n as C,j as X}from"./index-Cr3t3WWS.js";const G={name:"RequestsList",components:{ArrowLeft:V,Plus:E,ChevronRight:A,POCreationModal:j},data(){return{isLoading:!1,selectedStatus:"all",requests:[],showPOModal:!1,selectedRequest:null,statusFilters:[{value:"all",label:"All",icon:M,count:0},{value:"pending",label:"Pending",icon:z,count:0},{value:"ordered",label:"Ordered",icon:M,count:0},{value:"partial",label:"Partial",icon:H,count:0},{value:"received",label:"Received",icon:I,count:0}]}},computed:{filteredRequests(){return this.selectedStatus==="all"?this.requests:this.requests.filter(t=>t.status===this.selectedStatus)}},mounted(){this.loadRequests(),this.$route.query.status&&(this.selectedStatus=this.$route.query.status)},methods:{loadRequests(){return S(this,null,function*(){this.isLoading=!0;try{const t=yield fetch("/api/method/material_requisition.api.material_request.get_requests_with_po_status",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=yield t.json();if(e.exc)throw new Error(e.exc);this.requests=(e.message||[]).map(r=>v(_({},r),{status:this.getRequestStatus(r)})),this.updateStatusCounts()}catch(t){console.error("Failed to load requests:",t),this.requests=[]}finally{this.isLoading=!1}})},updateStatusCounts(){const t={all:this.requests.length,pending:0,ordered:0,partial:0,received:0};this.requests.forEach(e=>{t[e.status]!==void 0&&t[e.status]++}),this.statusFilters.forEach(e=>{e.count=t[e.value]||0})},selectStatus(t){this.selectedStatus=t,this.$router.replace({query:v(_({},this.$route.query),{status:t==="all"?void 0:t})})},goBack(){this.$router.go(-1)},createNewRequest(){this.$router.push("/create-request")},viewRequest(t){this.$router.push(`/request/${t}`)},createPO(t){this.selectedRequest=t,this.showPOModal=!0},closePOModal(){this.showPOModal=!1,this.selectedRequest=null},onPOCreated(){this.closePOModal(),this.loadRequests()},formatDate(t){return new Date(t).toLocaleDateString()},getRequestStatus(t){return t.per_received===100?"received":t.per_ordered===100?"ordered":t.per_ordered>0?"partial":"pending"},getStatusLabel(t){return{pending:"Pending",ordered:"Ordered",partial:"Partially Received",received:"Received"}[t]||t},getStatusBadgeClass(t){return{pending:"bg-yellow-100 text-yellow-800",ordered:"bg-blue-100 text-blue-800",partial:"bg-purple-100 text-purple-800",received:"bg-green-100 text-green-800"}[t]||"bg-gray-100 text-gray-800"},getPOStatusBadgeClass(t){return{Draft:"bg-gray-100 text-gray-800","To Receive and Bill":"bg-blue-100 text-blue-800","To Bill":"bg-yellow-100 text-yellow-800",Completed:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}}},J={class:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6"},K={class:"max-w-7xl mx-auto"},Q={class:"flex items-center justify-between mb-8"},U={class:"flex space-x-4"},W={class:"flex space-x-2 mb-6 overflow-x-auto"},Y=["onClick"],Z={key:0,class:"bg-blue-600 text-white text-xs px-2 py-1 rounded-full"},$={key:0,class:"text-center py-12"},ee={key:1,class:"grid gap-6"},te={class:"flex items-center justify-between mb-4"},se={class:"text-xl font-bold text-gray-800"},ae={class:"text-gray-600"},re={class:"flex items-center space-x-3"},le=["onClick"],oe={class:"mb-4"},ne={class:"text-sm text-gray-600 mb-2"},ie={class:"flex flex-wrap gap-2"},de={key:0,class:"bg-gray-200 text-gray-600 px-3 py-1 rounded-full text-sm"},ue={key:0,class:"border-t pt-4"},ce={class:"flex items-center justify-between"},ge=["onClick"],pe={key:1,class:"border-t pt-4"},he={class:"space-y-2"},xe={class:"font-medium text-gray-800"},me={class:"text-sm text-gray-600"},be={key:2,class:"text-center py-16"},ye={class:"text-gray-600 mb-6"};function fe(t,e,r,k,d,l){const y=x("ArrowLeft"),g=x("Plus"),c=x("ChevronRight"),p=x("POCreationModal");return o(),n("div",J,[s("div",K,[s("div",Q,[e[5]||(e[5]=s("div",null,[s("h1",{class:"text-4xl font-bold text-gray-800 mb-2"},"ðŸ“‹ Material Requests"),s("p",{class:"text-lg text-gray-600"},"Manage and track your material requisitions")],-1)),s("div",U,[s("button",{onClick:e[0]||(e[0]=(...a)=>l.goBack&&l.goBack(...a)),class:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[w(y,{class:"w-5 h-5"}),e[3]||(e[3]=s("span",null,"Back",-1))]),s("button",{onClick:e[1]||(e[1]=(...a)=>l.createNewRequest&&l.createNewRequest(...a)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[w(g,{class:"w-5 h-5"}),e[4]||(e[4]=s("span",null,"New Request",-1))])])]),s("div",W,[(o(!0),n(m,null,b(d.statusFilters,a=>(o(),n("button",{key:a.value,class:C(["px-6 py-3 rounded-lg font-medium transition-colors whitespace-nowrap flex items-center space-x-2",d.selectedStatus===a.value?"bg-blue-500 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"]),onClick:f=>l.selectStatus(a.value)},[(o(),O(X(a.icon),{class:"w-5 h-5"})),s("span",null,i(a.label),1),a.count>0?(o(),n("span",Z,i(a.count),1)):h("",!0)],10,Y))),128))]),d.isLoading?(o(),n("div",$,e[6]||(e[6]=[s("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1),s("p",{class:"mt-4 text-gray-600"},"Loading requests...",-1)]))):l.filteredRequests.length>0?(o(),n("div",ee,[(o(!0),n(m,null,b(l.filteredRequests,a=>{var f,R;return o(),n("div",{key:a.name,class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[s("div",te,[s("div",null,[s("h3",se,i(a.name),1),s("p",ae,i(l.formatDate(a.transaction_date)),1)]),s("div",re,[s("span",{class:C([l.getStatusBadgeClass(a.status),"px-4 py-2 rounded-lg text-sm font-bold"])},i(l.getStatusLabel(a.status)),3),s("button",{onClick:u=>l.viewRequest(a.name),class:"text-blue-500 hover:text-blue-600"},[w(c,{class:"w-6 h-6"})],8,le)])]),s("div",oe,[s("p",ne,"Items ("+i(((f=a.items)==null?void 0:f.length)||0)+")",1),s("div",ie,[(o(!0),n(m,null,b((a.items||[]).slice(0,3),u=>(o(),n("span",{key:u.item_code,class:"bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm"},i(u.item_name),1))),128)),(a.items||[]).length>3?(o(),n("span",de," +"+i((a.items||[]).length-3)+" more ",1)):h("",!0)])]),a.status==="pending"?(o(),n("div",ue,[s("div",ce,[e[7]||(e[7]=s("p",{class:"text-sm font-medium text-gray-700"},"Create Purchase Order",-1)),s("button",{onClick:u=>l.createPO(a),class:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"}," Create PO ",8,ge)])])):((R=a.purchase_orders)==null?void 0:R.length)>0?(o(),n("div",pe,[e[8]||(e[8]=s("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Purchase Orders",-1)),s("div",he,[(o(!0),n(m,null,b(a.purchase_orders,u=>(o(),n("div",{key:u.name,class:"flex items-center justify-between bg-gray-50 p-3 rounded-lg"},[s("div",null,[s("p",xe,i(u.name),1),s("p",me,i(u.supplier),1)]),s("span",{class:C([l.getPOStatusBadgeClass(u.status),"px-3 py-1 rounded-full text-xs font-bold"])},i(u.status),3)]))),128))])])):h("",!0)])}),128))])):(o(),n("div",be,[e[9]||(e[9]=s("div",{class:"text-6xl mb-4"},"ðŸ“‹",-1)),e[10]||(e[10]=s("h3",{class:"text-xl font-bold text-gray-800 mb-2"},"No requests found",-1)),s("p",ye,i(d.selectedStatus==="all"?"No material requests yet":`No ${d.selectedStatus} requests`),1),s("button",{onClick:e[2]||(e[2]=(...a)=>l.createNewRequest&&l.createNewRequest(...a)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors"}," Create First Request ")]))]),d.showPOModal?(o(),O(p,{key:0,request:d.selectedRequest,onClose:l.closePOModal,onCreated:l.onPOCreated},null,8,["request","onClose","onCreated"])):h("",!0)])}const Ce=D(G,[["render",fe]]);export{Ce as default};
