var p=(s,e,a)=>new Promise((b,o)=>{var d=l=>{try{m(a.next(l))}catch(u){o(u)}},g=l=>{try{m(a.throw(l))}catch(u){o(u)}},m=l=>l.done?b(l.value):Promise.resolve(l.value).then(d,g);m((a=a.apply(s,e)).next())});import{_ as D,e as n,f as t,t as c,i as x,r as h,h as _,l as w,w as f,v as k,F as v,j as C,m as S,n as q,g as O,o as i}from"./index-DQBZAqt6.js";import{S as P,C as T,X as V}from"./x-BgDw9y7S.js";const F={name:"POCreationModal",components:{X:V,ChevronDown:T,ShoppingCart:P},props:{request:{type:Object,required:!0}},emits:["close","created"],data(){return{isSubmitting:!1,showValidation:!1,suppliers:[],formData:{supplier:"",required_date:this.getDefaultRequiredDate(),notes:""}}},computed:{today(){return new Date().toISOString().split("T")[0]},isFormValid(){return this.formData.supplier&&this.formData.required_date}},mounted(){return p(this,null,function*(){yield this.loadSuppliers()})},methods:{getDefaultRequiredDate(){const s=new Date;return s.setDate(s.getDate()+14),s.toISOString().split("T")[0]},loadSuppliers(){return p(this,null,function*(){try{const s=yield fetch("/api/method/material_requisition.api.purchase_order.get_suppliers",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const e=yield s.json();if(e.exc)throw new Error(e.exc);this.suppliers=e.message||[]}catch(s){console.error("Failed to load suppliers:",s),this.suppliers=[]}})},createPO(){return p(this,null,function*(){var s;if(!this.isFormValid){this.showValidation=!0;return}this.isSubmitting=!0;try{const e=yield fetch("/api/method/material_requisition.api.purchase_order.create_from_material_request",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""},body:JSON.stringify({material_request:this.request.name,supplier:this.formData.supplier,required_date:this.formData.required_date,notes:this.formData.notes})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=yield e.json();if(a.exc)throw new Error(a.exc);this.showSuccessMessage((s=a.message)==null?void 0:s.name),this.$emit("created",a.message)}catch(e){console.error("Failed to create PO:",e),this.showErrorMessage(e.message)}finally{this.isSubmitting=!1}})},showSuccessMessage(s){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent=`✅ Purchase Order ${s} created successfully!`,document.body.appendChild(e),setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e)},3e3)},showErrorMessage(s){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent=`❌ Error: ${s}`,document.body.appendChild(e),setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e)},5e3)}}},j={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},E={class:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},M={class:"flex items-center justify-between p-6 border-b"},N={class:"text-gray-600"},B={class:"p-6"},R={class:"mb-6"},X={class:"relative"},z=["value"],I={key:0,class:"text-red-500 text-sm mt-1"},U={class:"mb-6"},H=["min"],A={key:0,class:"text-red-500 text-sm mt-1"},J={class:"mb-6"},L={class:"bg-gray-50 rounded-lg p-4 max-h-48 overflow-y-auto"},G={class:"font-medium text-gray-800"},K={class:"text-sm text-gray-600"},Q={class:"text-right"},W={class:"font-semibold text-gray-800"},Y={class:"mb-6"},Z={class:"flex justify-end space-x-4"},$=["disabled"],ee={key:0},te={key:1},se={key:3,class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"};function re(s,e,a,b,o,d){var u,y;const g=h("X"),m=h("ChevronDown"),l=h("ShoppingCart");return i(),n("div",j,[t("div",E,[t("div",M,[t("div",null,[e[6]||(e[6]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Create Purchase Order",-1)),t("p",N,c((u=a.request)==null?void 0:u.name),1)]),t("button",{onClick:e[0]||(e[0]=r=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[x(g,{class:"w-6 h-6"})])]),t("div",B,[t("div",R,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[w(" Supplier "),t("span",{class:"text-red-500"},"*")],-1)),t("div",X,[f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.formData.supplier=r),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white",required:""},[e[7]||(e[7]=t("option",{value:""},"Select a supplier...",-1)),(i(!0),n(v,null,C(o.suppliers,r=>(i(),n("option",{key:r.name,value:r.name},c(r.supplier_name),9,z))),128))],512),[[k,o.formData.supplier]]),x(m,{class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5 pointer-events-none"})]),!o.formData.supplier&&o.showValidation?(i(),n("p",I," Please select a supplier ")):_("",!0)]),t("div",U,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[w(" Required By "),t("span",{class:"text-red-500"},"*")],-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.formData.required_date=r),type:"date",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:d.today,required:""},null,8,H),[[S,o.formData.required_date]]),!o.formData.required_date&&o.showValidation?(i(),n("p",A," Please select a required date ")):_("",!0)]),t("div",J,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-3"},"Items to Order",-1)),t("div",L,[(i(!0),n(v,null,C(((y=a.request)==null?void 0:y.items)||[],r=>(i(),n("div",{key:r.item_code,class:"flex items-center justify-between py-2 border-b border-gray-200 last:border-b-0"},[t("div",null,[t("p",G,c(r.item_name),1),t("p",K,c(r.item_code),1)]),t("div",Q,[t("p",W,c(r.qty)+" "+c(r.uom),1)])]))),128))])]),t("div",Y,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Notes (Optional) ",-1)),f(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.formData.notes=r),rows:"3",placeholder:"Add any special instructions for the supplier...",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[S,o.formData.notes]])]),t("div",Z,[t("button",{onClick:e[4]||(e[4]=r=>s.$emit("close")),class:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"}," Cancel "),t("button",{onClick:e[5]||(e[5]=(...r)=>d.createPO&&d.createPO(...r)),disabled:o.isSubmitting||!d.isFormValid,class:q(["px-8 py-3 rounded-lg font-semibold flex items-center space-x-2 transition-all",o.isSubmitting||!d.isFormValid?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white transform hover:scale-105 shadow-lg"])},[o.isSubmitting?(i(),n("span",ee,"Creating PO...")):(i(),n("span",te,"Create Purchase Order")),o.isSubmitting?(i(),n("div",se)):(i(),O(l,{key:2,class:"w-5 h-5"}))],10,$)])])])])}const ne=D(F,[["render",re]]);export{ne as P};
