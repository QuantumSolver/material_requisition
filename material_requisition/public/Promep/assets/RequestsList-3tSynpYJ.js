var T=Object.defineProperty,j=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var S=(t,e,a)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,_=(t,e)=>{for(var a in e||(e={}))D.call(e,a)&&S(t,a,e[a]);if(R)for(var a of R(e))E.call(e,a)&&S(t,a,e[a]);return t},w=(t,e)=>j(t,A(e));var O=(t,e,a)=>new Promise((P,u)=>{var l=c=>{try{g(a.next(c))}catch(p){u(p)}},f=c=>{try{g(a.throw(c))}catch(p){u(p)}},g=c=>c.done?P(c.value):Promise.resolve(c.value).then(l,f);g((a=a.apply(t,e)).next())});import{P as I}from"./POCreationModal-DOjXLti_.js";import{c as V,_ as z,C as L,T as M,a as B,P as C,b as H,d as X,e as n,f as s,g as N,h,i as m,r as x,F as b,j as y,t as i,o,n as k,k as G}from"./index-DQBZAqt6.js";import{A as J}from"./x-BgDw9y7S.js";/**
 * @license lucide-vue-next v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=V("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Q={name:"RequestsList",components:{ArrowLeft:J,Plus:X,ChevronRight:H,Package:C,Clock:B,Truck:M,CheckCircle:L,AlertCircle:K,POCreationModal:I},data(){return{isLoading:!1,selectedStatus:"all",requests:[],showPOModal:!1,selectedRequest:null,statusFilters:[{value:"all",label:"All",icon:C,count:0},{value:"pending",label:"Pending",icon:B,count:0},{value:"ordered",label:"Ordered",icon:C,count:0},{value:"partial",label:"Partial",icon:M,count:0},{value:"received",label:"Received",icon:L,count:0}]}},computed:{filteredRequests(){return this.selectedStatus==="all"?this.requests:this.requests.filter(t=>t.status===this.selectedStatus)}},mounted(){this.loadRequests(),this.$route.query.status&&(this.selectedStatus=this.$route.query.status)},methods:{loadRequests(){return O(this,null,function*(){this.isLoading=!0;try{const t=yield fetch("/api/method/material_requisition.api.material_request.get_requests_with_po_status",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=yield t.json();if(e.exc)throw new Error(e.exc);this.requests=(e.message||[]).map(a=>w(_({},a),{status:this.getRequestStatus(a)})),this.updateStatusCounts()}catch(t){console.error("Failed to load requests:",t),this.requests=[]}finally{this.isLoading=!1}})},updateStatusCounts(){const t={all:this.requests.length,pending:0,ordered:0,partial:0,received:0};this.requests.forEach(e=>{t[e.status]!==void 0&&t[e.status]++}),this.statusFilters.forEach(e=>{e.count=t[e.value]||0})},selectStatus(t){this.selectedStatus=t,this.$router.replace({query:w(_({},this.$route.query),{status:t==="all"?void 0:t})})},goBack(){this.$router.go(-1)},createNewRequest(){this.$router.push("/create-request")},viewLineItems(){this.$router.push("/line-items")},viewRequest(t){this.$router.push(`/request/${t}`)},createPO(t){this.selectedRequest=t,this.showPOModal=!0},closePOModal(){this.showPOModal=!1,this.selectedRequest=null},onPOCreated(){this.closePOModal(),this.loadRequests()},formatDate(t){return new Date(t).toLocaleDateString()},getRequestStatus(t){return t.per_received===100?"received":t.per_ordered===100?"ordered":t.per_ordered>0?"partial":"pending"},getStatusLabel(t){return{pending:"Pending",ordered:"Ordered",partial:"Partially Received",received:"Received"}[t]||t},getStatusBadgeClass(t){return{pending:"bg-yellow-100 text-yellow-800",ordered:"bg-blue-100 text-blue-800",partial:"bg-purple-100 text-purple-800",received:"bg-green-100 text-green-800"}[t]||"bg-gray-100 text-gray-800"},getPOStatusBadgeClass(t){return{Draft:"bg-gray-100 text-gray-800","To Receive and Bill":"bg-blue-100 text-blue-800","To Bill":"bg-yellow-100 text-yellow-800",Completed:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}}},U={class:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6"},W={class:"max-w-7xl mx-auto"},Y={class:"flex items-center justify-between mb-8"},Z={class:"flex space-x-4"},$={class:"flex space-x-2 mb-6 overflow-x-auto"},ee=["onClick"],te={key:0,class:"bg-blue-600 text-white text-xs px-2 py-1 rounded-full"},se={key:0,class:"text-center py-12"},re={key:1,class:"grid gap-6"},le={class:"flex items-center justify-between mb-4"},ae={class:"text-xl font-bold text-gray-800"},oe={class:"text-gray-600"},ne={class:"flex items-center space-x-3"},ie=["onClick"],ue={class:"mb-4"},de={class:"text-sm text-gray-600 mb-2"},ce={class:"flex flex-wrap gap-2"},ge={key:0,class:"bg-gray-200 text-gray-600 px-3 py-1 rounded-full text-sm"},pe={key:0,class:"border-t pt-4"},xe={class:"flex items-center justify-between"},he=["onClick"],me={key:1,class:"border-t pt-4"},be={class:"space-y-2"},ye={class:"font-medium text-gray-800"},fe={class:"text-sm text-gray-600"},ve={key:2,class:"text-center py-16"},_e={class:"text-gray-600 mb-6"};function we(t,e,a,P,u,l){const f=x("ArrowLeft"),g=x("Package"),c=x("Plus"),p=x("ChevronRight"),F=x("POCreationModal");return o(),n("div",U,[s("div",W,[s("div",Y,[e[7]||(e[7]=s("div",null,[s("h1",{class:"text-4xl font-bold text-gray-800 mb-2"},"ðŸ“‹ Material Requests"),s("p",{class:"text-lg text-gray-600"},"Manage and track your material requisitions")],-1)),s("div",Z,[s("button",{onClick:e[0]||(e[0]=(...r)=>l.goBack&&l.goBack(...r)),class:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[m(f,{class:"w-5 h-5"}),e[4]||(e[4]=s("span",null,"Back",-1))]),s("button",{onClick:e[1]||(e[1]=(...r)=>l.viewLineItems&&l.viewLineItems(...r)),class:"bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[m(g,{class:"w-5 h-5"}),e[5]||(e[5]=s("span",null,"Create PO",-1))]),s("button",{onClick:e[2]||(e[2]=(...r)=>l.createNewRequest&&l.createNewRequest(...r)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[m(c,{class:"w-5 h-5"}),e[6]||(e[6]=s("span",null,"New Request",-1))])])]),s("div",$,[(o(!0),n(b,null,y(u.statusFilters,r=>(o(),n("button",{key:r.value,class:k(["px-6 py-3 rounded-lg font-medium transition-colors whitespace-nowrap flex items-center space-x-2",u.selectedStatus===r.value?"bg-blue-500 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"]),onClick:v=>l.selectStatus(r.value)},[(o(),N(G(r.icon),{class:"w-5 h-5"})),s("span",null,i(r.label),1),r.count>0?(o(),n("span",te,i(r.count),1)):h("",!0)],10,ee))),128))]),u.isLoading?(o(),n("div",se,e[8]||(e[8]=[s("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1),s("p",{class:"mt-4 text-gray-600"},"Loading requests...",-1)]))):l.filteredRequests.length>0?(o(),n("div",re,[(o(!0),n(b,null,y(l.filteredRequests,r=>{var v,q;return o(),n("div",{key:r.name,class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[s("div",le,[s("div",null,[s("h3",ae,i(r.name),1),s("p",oe,i(l.formatDate(r.transaction_date)),1)]),s("div",ne,[s("span",{class:k([l.getStatusBadgeClass(r.status),"px-4 py-2 rounded-lg text-sm font-bold"])},i(l.getStatusLabel(r.status)),3),s("button",{onClick:d=>l.viewRequest(r.name),class:"text-blue-500 hover:text-blue-600"},[m(p,{class:"w-6 h-6"})],8,ie)])]),s("div",ue,[s("p",de,"Items ("+i(((v=r.items)==null?void 0:v.length)||0)+")",1),s("div",ce,[(o(!0),n(b,null,y((r.items||[]).slice(0,3),d=>(o(),n("span",{key:d.item_code,class:"bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm"},i(d.item_name),1))),128)),(r.items||[]).length>3?(o(),n("span",ge," +"+i((r.items||[]).length-3)+" more ",1)):h("",!0)])]),r.status==="pending"?(o(),n("div",pe,[s("div",xe,[e[9]||(e[9]=s("p",{class:"text-sm font-medium text-gray-700"},"Create Purchase Order",-1)),s("button",{onClick:d=>l.createPO(r),class:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"}," Create PO ",8,he)])])):((q=r.purchase_orders)==null?void 0:q.length)>0?(o(),n("div",me,[e[10]||(e[10]=s("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Purchase Orders",-1)),s("div",be,[(o(!0),n(b,null,y(r.purchase_orders,d=>(o(),n("div",{key:d.name,class:"flex items-center justify-between bg-gray-50 p-3 rounded-lg"},[s("div",null,[s("p",ye,i(d.name),1),s("p",fe,i(d.supplier),1)]),s("span",{class:k([l.getPOStatusBadgeClass(d.status),"px-3 py-1 rounded-full text-xs font-bold"])},i(d.status),3)]))),128))])])):h("",!0)])}),128))])):(o(),n("div",ve,[e[11]||(e[11]=s("div",{class:"text-6xl mb-4"},"ðŸ“‹",-1)),e[12]||(e[12]=s("h3",{class:"text-xl font-bold text-gray-800 mb-2"},"No requests found",-1)),s("p",_e,i(u.selectedStatus==="all"?"No material requests yet":`No ${u.selectedStatus} requests`),1),s("button",{onClick:e[3]||(e[3]=(...r)=>l.createNewRequest&&l.createNewRequest(...r)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors"}," Create First Request ")]))]),u.showPOModal?(o(),N(F,{key:0,request:u.selectedRequest,onClose:l.closePOModal,onCreated:l.onPOCreated},null,8,["request","onClose","onCreated"])):h("",!0)])}const Re=z(Q,[["render",we]]);export{Re as default};
