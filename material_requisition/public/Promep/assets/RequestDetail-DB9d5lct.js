var b=(s,t,c)=>new Promise((h,n)=>{var o=d=>{try{u(c.next(d))}catch(g){n(g)}},m=d=>{try{u(c.throw(d))}catch(g){n(g)}},u=d=>d.done?h(d.value):Promise.resolve(d.value).then(o,m);u((c=c.apply(s,t)).next())});import{P}from"./POCreationModal-QJmVfm5-.js";import{_ as C,P as O,e as i,f as e,g as R,h as _,t as l,i as x,r as p,n as v,F as w,j as q,o as a}from"./index-2cUDdOTE.js";import{E as B,S as N,A as M}from"./x-S9s7KQQn.js";const S={name:"RequestDetail",components:{ArrowLeft:M,Package:O,ShoppingCart:N,ExternalLink:B,POCreationModal:P},props:{id:{type:String,required:!0}},data(){return{isLoading:!1,request:null,showPOModal:!1}},computed:{requestId(){return this.id||this.$route.params.id}},mounted(){return b(this,null,function*(){yield this.loadRequest()})},methods:{loadRequest(){return b(this,null,function*(){this.isLoading=!0;try{const s=yield fetch("/api/method/material_requisition.api.material_request.get_request_detail",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""},body:JSON.stringify({request_name:this.requestId})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=yield s.json();if(t.exc)throw new Error(t.exc);this.request=t.message,this.request&&(this.request.status=this.getRequestStatus(this.request))}catch(s){console.error("Failed to load request:",s),this.request=null}finally{this.isLoading=!1}})},goBack(){this.$router.go(-1)},openInERPNext(){const s=`/app/material-request/${this.requestId}`;window.open(s,"_blank")},openPOInERPNext(s){const t=`/app/purchase-order/${s}`;window.open(t,"_blank")},createPO(){this.showPOModal=!0},closePOModal(){this.showPOModal=!1},onPOCreated(){this.closePOModal(),this.loadRequest()},formatDate(s){return s?new Date(s).toLocaleDateString():"Not specified"},formatCurrency(s){return s?new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(s):"â‚¹0.00"},getRequestStatus(s){return s.per_received===100?"received":s.per_ordered===100?"ordered":s.per_ordered>0?"partial":"pending"},getStatusLabel(s){return{pending:"Pending",ordered:"Ordered",partial:"Partially Received",received:"Received"}[s]||s},getStatusBadgeClass(s){return{pending:"bg-yellow-100 text-yellow-800",ordered:"bg-blue-100 text-blue-800",partial:"bg-purple-100 text-purple-800",received:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"},getPOStatusBadgeClass(s){return{Draft:"bg-gray-100 text-gray-800","To Receive and Bill":"bg-blue-100 text-blue-800","To Bill":"bg-yellow-100 text-yellow-800",Completed:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}}},L={class:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6"},E={class:"max-w-4xl mx-auto"},I={class:"flex items-center justify-between mb-8"},D={class:"text-4xl font-bold text-gray-800 mb-2"},j={class:"flex space-x-3"},T={key:0,class:"text-center py-12"},F={key:1,class:"space-y-6"},A={class:"bg-white rounded-xl shadow-lg p-6"},V={class:"flex items-center justify-between mb-6"},z={class:"text-2xl font-bold text-gray-800"},G={class:"text-gray-600"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},J={class:"text-gray-800"},X={class:"text-gray-800"},K={key:0,class:"md:col-span-2"},Q={class:"text-gray-800"},U={class:"bg-white rounded-xl shadow-lg p-6"},W={class:"text-xl font-bold text-gray-800 mb-6"},Y={class:"space-y-4"},Z={class:"flex items-center space-x-4"},$={class:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"},ee={class:"font-medium text-gray-800"},te={class:"text-sm text-gray-600"},se={class:"text-sm text-gray-500"},re={class:"text-right"},oe={class:"font-semibold text-gray-800"},ne={class:"text-sm text-gray-600"},le={key:0,class:"bg-white rounded-xl shadow-lg p-6"},ae={class:"space-y-4"},ie={class:"flex-1"},de={class:"flex items-center space-x-2"},ce={class:"font-medium text-gray-800"},ue=["onClick"],ge={class:"text-sm text-gray-600"},xe={class:"text-sm text-gray-500"},pe={class:"text-right"},me={class:"text-sm text-gray-600 mt-1"},_e={key:1,class:"bg-white rounded-xl shadow-lg p-6"},be={class:"flex space-x-4"},he={key:2,class:"text-center py-16"};function ye(s,t,c,h,n,o){var y,f;const m=p("ExternalLink"),u=p("ArrowLeft"),d=p("Package"),g=p("ShoppingCart"),k=p("POCreationModal");return a(),i("div",L,[e("div",E,[e("div",I,[e("div",null,[e("h1",D,"ðŸ“‹ "+l(o.requestId),1),t[4]||(t[4]=e("p",{class:"text-lg text-gray-600"},"Material Request Details",-1))]),e("div",j,[e("button",{onClick:t[0]||(t[0]=(...r)=>o.openInERPNext&&o.openInERPNext(...r)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[x(m,{class:"w-5 h-5"}),t[5]||(t[5]=e("span",null,"Open in ERPNext",-1))]),e("button",{onClick:t[1]||(t[1]=(...r)=>o.goBack&&o.goBack(...r)),class:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[x(u,{class:"w-5 h-5"}),t[6]||(t[6]=e("span",null,"Back",-1))])])]),n.isLoading?(a(),i("div",T,t[7]||(t[7]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Loading request details...",-1)]))):n.request?(a(),i("div",F,[e("div",A,[e("div",V,[e("div",null,[e("h2",z,l(n.request.name),1),e("p",G,"Created on "+l(o.formatDate(n.request.transaction_date)),1)]),e("span",{class:v([o.getStatusBadgeClass(n.request.status),"px-6 py-3 rounded-xl text-lg font-bold"])},l(o.getStatusLabel(n.request.status)),3)]),e("div",H,[e("div",null,[t[8]||(t[8]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Project",-1)),e("p",J,l(n.request.project||"Not specified"),1)]),e("div",null,[t[9]||(t[9]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Required By",-1)),e("p",X,l(o.formatDate(n.request.schedule_date)),1)]),n.request.remarks?(a(),i("div",K,[t[10]||(t[10]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Notes",-1)),e("p",Q,l(n.request.remarks),1)])):_("",!0)])]),e("div",U,[e("h3",W,"Items ("+l(((y=n.request.items)==null?void 0:y.length)||0)+")",1),e("div",Y,[(a(!0),i(w,null,q(n.request.items||[],r=>(a(),i("div",{key:r.item_code,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[e("div",Z,[e("div",$,[x(d,{class:"w-6 h-6 text-blue-600"})]),e("div",null,[e("p",ee,l(r.item_name),1),e("p",te,l(r.item_code),1),e("p",se,l(r.description||"No description"),1)])]),e("div",re,[e("p",oe,l(r.qty)+" "+l(r.uom),1),e("div",ne,[e("p",null,"Ordered: "+l(r.ordered_qty||0),1),e("p",null,"Received: "+l(r.received_qty||0),1)])])]))),128))])]),((f=n.request.purchase_orders)==null?void 0:f.length)>0?(a(),i("div",le,[t[11]||(t[11]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6"},"Purchase Orders",-1)),e("div",ae,[(a(!0),i(w,null,q(n.request.purchase_orders,r=>(a(),i("div",{key:r.name,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[e("div",ie,[e("div",de,[e("p",ce,l(r.name),1),e("button",{onClick:fe=>o.openPOInERPNext(r.name),class:"text-blue-500 hover:text-blue-700 transition-colors",title:"Open in ERPNext"},[x(m,{class:"w-4 h-4"})],8,ue)]),e("p",ge,l(r.supplier),1),e("p",xe,l(o.formatDate(r.transaction_date)),1)]),e("div",pe,[e("span",{class:v([o.getPOStatusBadgeClass(r.status),"px-3 py-1 rounded-full text-sm font-bold"])},l(r.status),3),e("p",me,l(o.formatCurrency(r.grand_total)),1)])]))),128))])])):_("",!0),n.request.status==="pending"?(a(),i("div",_e,[t[13]||(t[13]=e("h3",{class:"text-xl font-bold text-gray-800 mb-4"},"Actions",-1)),e("div",be,[e("button",{onClick:t[2]||(t[2]=(...r)=>o.createPO&&o.createPO(...r)),class:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center space-x-2"},[x(g,{class:"w-5 h-5"}),t[12]||(t[12]=e("span",null,"Create Purchase Order",-1))])])])):_("",!0)])):(a(),i("div",he,[t[14]||(t[14]=e("div",{class:"text-6xl mb-4"},"âŒ",-1)),t[15]||(t[15]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2"},"Request not found",-1)),t[16]||(t[16]=e("p",{class:"text-gray-600 mb-6"},"The requested material request could not be found.",-1)),e("button",{onClick:t[3]||(t[3]=(...r)=>o.goBack&&o.goBack(...r)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors"}," Go Back ")]))]),n.showPOModal?(a(),R(k,{key:0,request:n.request,onClose:o.closePOModal,onCreated:o.onPOCreated},null,8,["request","onClose","onCreated"])):_("",!0)])}const Pe=C(S,[["render",ye]]);export{Pe as default};
