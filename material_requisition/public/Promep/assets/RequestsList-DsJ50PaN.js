var I=Object.defineProperty,T=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var O=(t,e,a)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,v=(t,e)=>{for(var a in e||(e={}))A.call(e,a)&&O(t,a,e[a]);if(q)for(var a of q(e))D.call(e,a)&&O(t,a,e[a]);return t},w=(t,e)=>T(t,j(e));var S=(t,e,a)=>new Promise((P,u)=>{var r=d=>{try{h(a.next(d))}catch(g){u(g)}},f=d=>{try{h(a.throw(d))}catch(g){u(g)}},h=d=>d.done?P(d.value):Promise.resolve(d.value).then(r,f);h((a=a.apply(t,e)).next())});import{P as V}from"./POCreationModal-QJmVfm5-.js";import{c as z,_ as H,C as L,T as M,a as N,P as k,b as X,d as G,e as o,f as s,g as B,h as m,i as p,r as x,F as b,j as y,t as c,o as n,n as C,k as J}from"./index-2cUDdOTE.js";import{E as K,A as Q}from"./x-S9s7KQQn.js";/**
 * @license lucide-vue-next v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=z("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),W={name:"RequestsList",components:{ArrowLeft:Q,Plus:G,ChevronRight:X,Package:k,Clock:N,Truck:M,CheckCircle:L,AlertCircle:U,ExternalLink:K,POCreationModal:V},data(){return{isLoading:!1,selectedStatus:"all",requests:[],showPOModal:!1,selectedRequest:null,statusFilters:[{value:"all",label:"All",icon:k,count:0},{value:"pending",label:"Pending",icon:N,count:0},{value:"ordered",label:"Ordered",icon:k,count:0},{value:"partial",label:"Partial",icon:M,count:0},{value:"received",label:"Received",icon:L,count:0}]}},computed:{filteredRequests(){return this.selectedStatus==="all"?this.requests:this.requests.filter(t=>t.status===this.selectedStatus)}},mounted(){this.loadRequests(),this.$route.query.status&&(this.selectedStatus=this.$route.query.status)},methods:{loadRequests(){return S(this,null,function*(){this.isLoading=!0;try{const t=yield fetch("/api/method/material_requisition.api.material_request.get_requests_with_po_status",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=yield t.json();if(e.exc)throw new Error(e.exc);this.requests=(e.message||[]).map(a=>w(v({},a),{status:this.getRequestStatus(a)})),this.updateStatusCounts()}catch(t){console.error("Failed to load requests:",t),this.requests=[]}finally{this.isLoading=!1}})},updateStatusCounts(){const t={all:this.requests.length,pending:0,ordered:0,partial:0,received:0};this.requests.forEach(e=>{t[e.status]!==void 0&&t[e.status]++}),this.statusFilters.forEach(e=>{e.count=t[e.value]||0})},selectStatus(t){this.selectedStatus=t,this.$router.replace({query:w(v({},this.$route.query),{status:t==="all"?void 0:t})})},goBack(){this.$router.go(-1)},createNewRequest(){this.$router.push("/create-request")},viewLineItems(){this.$router.push("/line-items")},viewRequest(t){this.$router.push(`/request/${t}`)},openInERPNext(t){const e=`/app/material-request/${t}`;window.open(e,"_blank")},openPOInERPNext(t){const e=`/app/purchase-order/${t}`;window.open(e,"_blank")},createPO(t){this.selectedRequest=t,this.showPOModal=!0},closePOModal(){this.showPOModal=!1,this.selectedRequest=null},onPOCreated(){this.closePOModal(),this.loadRequests()},formatDate(t){return new Date(t).toLocaleDateString()},getRequestStatus(t){return t.per_received===100?"received":t.per_ordered===100?"ordered":t.per_ordered>0?"partial":"pending"},getStatusLabel(t){return{pending:"Pending",ordered:"Ordered",partial:"Partially Received",received:"Received"}[t]||t},getStatusBadgeClass(t){return{pending:"bg-yellow-100 text-yellow-800",ordered:"bg-blue-100 text-blue-800",partial:"bg-purple-100 text-purple-800",received:"bg-green-100 text-green-800"}[t]||"bg-gray-100 text-gray-800"},getPOStatusBadgeClass(t){return{Draft:"bg-gray-100 text-gray-800","To Receive and Bill":"bg-blue-100 text-blue-800","To Bill":"bg-yellow-100 text-yellow-800",Completed:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}}},Y={class:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6"},Z={class:"max-w-7xl mx-auto"},$={class:"flex items-center justify-between mb-8"},ee={class:"flex space-x-4"},te={class:"flex space-x-2 mb-6 overflow-x-auto"},se=["onClick"],le={key:0,class:"bg-blue-600 text-white text-xs px-2 py-1 rounded-full"},re={key:0,class:"text-center py-12"},ae={key:1,class:"grid gap-6"},ne={class:"flex items-center justify-between mb-4"},oe={class:"flex items-center space-x-2"},ie={class:"text-xl font-bold text-gray-800"},ce={class:"text-gray-600"},ue=["onClick"],de={class:"flex items-center space-x-3"},ge=["onClick"],pe={class:"mb-4"},xe={class:"text-sm text-gray-600 mb-2"},he={class:"flex flex-wrap gap-2"},me={key:0,class:"bg-gray-200 text-gray-600 px-3 py-1 rounded-full text-sm"},be={key:0,class:"border-t pt-4"},ye={class:"flex items-center justify-between"},fe=["onClick"],_e={key:1,class:"border-t pt-4"},ve={class:"space-y-2"},we={class:"flex items-center space-x-2"},ke={class:"font-medium text-gray-800"},Ce={class:"text-sm text-gray-600"},Pe=["onClick"],Re={key:2,class:"text-center py-16"},qe={class:"text-gray-600 mb-6"};function Oe(t,e,a,P,u,r){const f=x("ArrowLeft"),h=x("Package"),d=x("Plus"),g=x("ExternalLink"),E=x("ChevronRight"),F=x("POCreationModal");return n(),o("div",Y,[s("div",Z,[s("div",$,[e[7]||(e[7]=s("div",null,[s("h1",{class:"text-4xl font-bold text-gray-800 mb-2"},"ðŸ“‹ Material Requests"),s("p",{class:"text-lg text-gray-600"},"Manage and track your material requisitions")],-1)),s("div",ee,[s("button",{onClick:e[0]||(e[0]=(...l)=>r.goBack&&r.goBack(...l)),class:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[p(f,{class:"w-5 h-5"}),e[4]||(e[4]=s("span",null,"Back",-1))]),s("button",{onClick:e[1]||(e[1]=(...l)=>r.viewLineItems&&r.viewLineItems(...l)),class:"bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[p(h,{class:"w-5 h-5"}),e[5]||(e[5]=s("span",null,"Create PO",-1))]),s("button",{onClick:e[2]||(e[2]=(...l)=>r.createNewRequest&&r.createNewRequest(...l)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[p(d,{class:"w-5 h-5"}),e[6]||(e[6]=s("span",null,"New Request",-1))])])]),s("div",te,[(n(!0),o(b,null,y(u.statusFilters,l=>(n(),o("button",{key:l.value,class:C(["px-6 py-3 rounded-lg font-medium transition-colors whitespace-nowrap flex items-center space-x-2",u.selectedStatus===l.value?"bg-blue-500 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"]),onClick:_=>r.selectStatus(l.value)},[(n(),B(J(l.icon),{class:"w-5 h-5"})),s("span",null,c(l.label),1),l.count>0?(n(),o("span",le,c(l.count),1)):m("",!0)],10,se))),128))]),u.isLoading?(n(),o("div",re,e[8]||(e[8]=[s("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1),s("p",{class:"mt-4 text-gray-600"},"Loading requests...",-1)]))):r.filteredRequests.length>0?(n(),o("div",ae,[(n(!0),o(b,null,y(r.filteredRequests,l=>{var _,R;return n(),o("div",{key:l.name,class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[s("div",ne,[s("div",oe,[s("div",null,[s("h3",ie,c(l.name),1),s("p",ce,c(r.formatDate(l.transaction_date)),1)]),s("button",{onClick:i=>r.openInERPNext(l.name),class:"text-blue-500 hover:text-blue-700 transition-colors",title:"Open in ERPNext"},[p(g,{class:"w-4 h-4"})],8,ue)]),s("div",de,[s("span",{class:C([r.getStatusBadgeClass(l.status),"px-4 py-2 rounded-lg text-sm font-bold"])},c(r.getStatusLabel(l.status)),3),s("button",{onClick:i=>r.viewRequest(l.name),class:"text-blue-500 hover:text-blue-600"},[p(E,{class:"w-6 h-6"})],8,ge)])]),s("div",pe,[s("p",xe,"Items ("+c(((_=l.items)==null?void 0:_.length)||0)+")",1),s("div",he,[(n(!0),o(b,null,y((l.items||[]).slice(0,3),i=>(n(),o("span",{key:i.item_code,class:"bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm"},c(i.item_name),1))),128)),(l.items||[]).length>3?(n(),o("span",me," +"+c((l.items||[]).length-3)+" more ",1)):m("",!0)])]),l.status==="pending"?(n(),o("div",be,[s("div",ye,[e[9]||(e[9]=s("p",{class:"text-sm font-medium text-gray-700"},"Create Purchase Order",-1)),s("button",{onClick:i=>r.createPO(l),class:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"}," Create PO ",8,fe)])])):((R=l.purchase_orders)==null?void 0:R.length)>0?(n(),o("div",_e,[e[10]||(e[10]=s("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Purchase Orders",-1)),s("div",ve,[(n(!0),o(b,null,y(l.purchase_orders,i=>(n(),o("div",{key:i.name,class:"flex items-center justify-between bg-gray-50 p-3 rounded-lg"},[s("div",we,[s("div",null,[s("p",ke,c(i.name),1),s("p",Ce,c(i.supplier),1)]),s("button",{onClick:Se=>r.openPOInERPNext(i.name),class:"text-blue-500 hover:text-blue-700 transition-colors",title:"Open in ERPNext"},[p(g,{class:"w-3 h-3"})],8,Pe)]),s("span",{class:C([r.getPOStatusBadgeClass(i.status),"px-3 py-1 rounded-full text-xs font-bold"])},c(i.status),3)]))),128))])])):m("",!0)])}),128))])):(n(),o("div",Re,[e[11]||(e[11]=s("div",{class:"text-6xl mb-4"},"ðŸ“‹",-1)),e[12]||(e[12]=s("h3",{class:"text-xl font-bold text-gray-800 mb-2"},"No requests found",-1)),s("p",qe,c(u.selectedStatus==="all"?"No material requests yet":`No ${u.selectedStatus} requests`),1),s("button",{onClick:e[3]||(e[3]=(...l)=>r.createNewRequest&&r.createNewRequest(...l)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors"}," Create First Request ")]))]),u.showPOModal?(n(),B(F,{key:0,request:u.selectedRequest,onClose:r.closePOModal,onCreated:r.onPOCreated},null,8,["request","onClose","onCreated"])):m("",!0)])}const Ee=H(W,[["render",Oe]]);export{Ee as default};
