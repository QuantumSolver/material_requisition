var y=(s,t,u)=>new Promise((b,o)=>{var l=i=>{try{c(u.next(i))}catch(g){o(g)}},m=i=>{try{c(u.throw(i))}catch(g){o(g)}},c=i=>i.done?b(i.value):Promise.resolve(i.value).then(l,m);c((u=u.apply(s,t)).next())});import{P as k,S as C,A as P}from"./POCreationModal-zjbRPIrI.js";import{_ as O,g as B,c as d,a as e,b as M,d as x,t as a,e as h,r as p,n as q,F as v,f as w,o as n}from"./index-dssCXPyL.js";const S={name:"RequestDetail",components:{ArrowLeft:P,Package:B,ShoppingCart:C,POCreationModal:k},props:{id:{type:String,required:!0}},data(){return{isLoading:!1,request:null,showPOModal:!1}},computed:{requestId(){return this.id||this.$route.params.id}},mounted(){return y(this,null,function*(){yield this.loadRequest()})},methods:{loadRequest(){return y(this,null,function*(){this.isLoading=!0;try{const s=yield fetch("/api/method/material_requisition.api.material_request.get_request_detail",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""},body:JSON.stringify({request_name:this.requestId})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=yield s.json();if(t.exc)throw new Error(t.exc);this.request=t.message,this.request&&(this.request.status=this.getRequestStatus(this.request))}catch(s){console.error("Failed to load request:",s),this.request=null}finally{this.isLoading=!1}})},goBack(){this.$router.go(-1)},createPO(){this.showPOModal=!0},closePOModal(){this.showPOModal=!1},onPOCreated(){this.closePOModal(),this.loadRequest()},formatDate(s){return s?new Date(s).toLocaleDateString():"Not specified"},formatCurrency(s){return s?new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(s):"₹0.00"},getRequestStatus(s){return s.per_received===100?"received":s.per_ordered===100?"ordered":s.per_ordered>0?"partial":"pending"},getStatusLabel(s){return{pending:"Pending",ordered:"Ordered",partial:"Partially Received",received:"Received"}[s]||s},getStatusBadgeClass(s){return{pending:"bg-yellow-100 text-yellow-800",ordered:"bg-blue-100 text-blue-800",partial:"bg-purple-100 text-purple-800",received:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"},getPOStatusBadgeClass(s){return{Draft:"bg-gray-100 text-gray-800","To Receive and Bill":"bg-blue-100 text-blue-800","To Bill":"bg-yellow-100 text-yellow-800",Completed:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}}},R={class:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6"},L={class:"max-w-4xl mx-auto"},D={class:"flex items-center justify-between mb-8"},N={class:"text-4xl font-bold text-gray-800 mb-2"},j={key:0,class:"text-center py-12"},T={key:1,class:"space-y-6"},I={class:"bg-white rounded-xl shadow-lg p-6"},F={class:"flex items-center justify-between mb-6"},A={class:"text-2xl font-bold text-gray-800"},E={class:"text-gray-600"},V={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},z={class:"text-gray-800"},G={class:"text-gray-800"},H={key:0,class:"md:col-span-2"},J={class:"text-gray-800"},X={class:"bg-white rounded-xl shadow-lg p-6"},K={class:"text-xl font-bold text-gray-800 mb-6"},Q={class:"space-y-4"},U={class:"flex items-center space-x-4"},W={class:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"},Y={class:"font-medium text-gray-800"},Z={class:"text-sm text-gray-600"},$={class:"text-sm text-gray-500"},ee={class:"text-right"},te={class:"font-semibold text-gray-800"},se={class:"text-sm text-gray-600"},re={key:0,class:"bg-white rounded-xl shadow-lg p-6"},oe={class:"space-y-4"},ae={class:"font-medium text-gray-800"},le={class:"text-sm text-gray-600"},ne={class:"text-sm text-gray-500"},de={class:"text-right"},ie={class:"text-sm text-gray-600 mt-1"},ue={key:1,class:"bg-white rounded-xl shadow-lg p-6"},ce={class:"flex space-x-4"},ge={key:2,class:"text-center py-16"};function xe(s,t,u,b,o,l){var _,f;const m=p("ArrowLeft"),c=p("Package"),i=p("ShoppingCart"),g=p("POCreationModal");return n(),d("div",R,[e("div",L,[e("div",D,[e("div",null,[e("h1",N,"📋 "+a(l.requestId),1),t[3]||(t[3]=e("p",{class:"text-lg text-gray-600"},"Material Request Details",-1))]),e("button",{onClick:t[0]||(t[0]=(...r)=>l.goBack&&l.goBack(...r)),class:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"},[h(m,{class:"w-5 h-5"}),t[4]||(t[4]=e("span",null,"Back",-1))])]),o.isLoading?(n(),d("div",j,t[5]||(t[5]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Loading request details...",-1)]))):o.request?(n(),d("div",T,[e("div",I,[e("div",F,[e("div",null,[e("h2",A,a(o.request.name),1),e("p",E,"Created on "+a(l.formatDate(o.request.transaction_date)),1)]),e("span",{class:q([l.getStatusBadgeClass(o.request.status),"px-6 py-3 rounded-xl text-lg font-bold"])},a(l.getStatusLabel(o.request.status)),3)]),e("div",V,[e("div",null,[t[6]||(t[6]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Project",-1)),e("p",z,a(o.request.project||"Not specified"),1)]),e("div",null,[t[7]||(t[7]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Required By",-1)),e("p",G,a(l.formatDate(o.request.schedule_date)),1)]),o.request.remarks?(n(),d("div",H,[t[8]||(t[8]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Notes",-1)),e("p",J,a(o.request.remarks),1)])):x("",!0)])]),e("div",X,[e("h3",K,"Items ("+a(((_=o.request.items)==null?void 0:_.length)||0)+")",1),e("div",Q,[(n(!0),d(v,null,w(o.request.items||[],r=>(n(),d("div",{key:r.item_code,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[e("div",U,[e("div",W,[h(c,{class:"w-6 h-6 text-blue-600"})]),e("div",null,[e("p",Y,a(r.item_name),1),e("p",Z,a(r.item_code),1),e("p",$,a(r.description||"No description"),1)])]),e("div",ee,[e("p",te,a(r.qty)+" "+a(r.uom),1),e("div",se,[e("p",null,"Ordered: "+a(r.ordered_qty||0),1),e("p",null,"Received: "+a(r.received_qty||0),1)])])]))),128))])]),((f=o.request.purchase_orders)==null?void 0:f.length)>0?(n(),d("div",re,[t[9]||(t[9]=e("h3",{class:"text-xl font-bold text-gray-800 mb-6"},"Purchase Orders",-1)),e("div",oe,[(n(!0),d(v,null,w(o.request.purchase_orders,r=>(n(),d("div",{key:r.name,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[e("div",null,[e("p",ae,a(r.name),1),e("p",le,a(r.supplier),1),e("p",ne,a(l.formatDate(r.transaction_date)),1)]),e("div",de,[e("span",{class:q([l.getPOStatusBadgeClass(r.status),"px-3 py-1 rounded-full text-sm font-bold"])},a(r.status),3),e("p",ie,a(l.formatCurrency(r.grand_total)),1)])]))),128))])])):x("",!0),o.request.status==="pending"?(n(),d("div",ue,[t[11]||(t[11]=e("h3",{class:"text-xl font-bold text-gray-800 mb-4"},"Actions",-1)),e("div",ce,[e("button",{onClick:t[1]||(t[1]=(...r)=>l.createPO&&l.createPO(...r)),class:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center space-x-2"},[h(i,{class:"w-5 h-5"}),t[10]||(t[10]=e("span",null,"Create Purchase Order",-1))])])])):x("",!0)])):(n(),d("div",ge,[t[12]||(t[12]=e("div",{class:"text-6xl mb-4"},"❌",-1)),t[13]||(t[13]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2"},"Request not found",-1)),t[14]||(t[14]=e("p",{class:"text-gray-600 mb-6"},"The requested material request could not be found.",-1)),e("button",{onClick:t[2]||(t[2]=(...r)=>l.goBack&&l.goBack(...r)),class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors"}," Go Back ")]))]),o.showPOModal?(n(),M(g,{key:0,request:o.request,onClose:l.closePOModal,onCreated:l.onPOCreated},null,8,["request","onClose","onCreated"])):x("",!0)])}const he=O(S,[["render",xe]]);export{he as default};
